<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üêü The Raw Report ‚Äî Sushi Fish ID</title>
<style>
  :root {
    font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial;
    background-color: #1b1b1b;
    color: #e0e0e0;
  }
  body {
    margin: 0 auto;
    max-width: 900px;
    padding: 20px;
    text-align: center;
  }
  img.logo {
    max-width: 200px;
    margin-bottom: 15px;
  }
  h1 {
    margin: 5px 0 15px;
    color: #39ff14; /* neon green */
  }
  p {
    color: #bbb;
  }
  .card {
    border: 1px solid #39ff14;
    border-radius: 12px;
    padding: 16px;
    margin: 12px 0;
    background: #2a2a2a;
  }
  label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
    color: #ff2fd0; /* neon pink */
  }
  input[type="file"],
  input[type="text"] {
    width: 100%;
    margin-bottom: 10px;
    background: #111;
    color: #fff;
    border: 1px solid #444;
    padding: 8px;
    border-radius: 6px;
  }
  button {
    background: #39ff14;
    color: #000;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background: #2ddc0e;
  }
  #preview {
    max-width: 100%;
    border-radius: 8px;
    margin-top: 10px;
  }
  pre {
    text-align: left;
    white-space: pre-wrap;
    background: #111;
    color: #fff;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #444;
  }
</style>
</head>
<body>

<!-- Logo embedded as Base64 -->
<img 
  class="logo" 
  alt="The Raw Report Logo" 
  src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QCMRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAf//AACgAgAEAAAAAQAAA3ygAwAEAAAAAQAAA3IAAAAA/+0AOFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAAOEJJTQQlAAAAAAAQ1B2M2Y8AsgTpgAmY7PhCfv/iAihJQ0NfUFJPRklMRQABAQAAAhhhcHBsBAAAAG1udHJSR0IgWFlaIAfmAAEAAQAAAAAAAGFjc3BBUFBMAAAAAEFQUEwAAAAAAAAAAAAAAAAAAAAAAAD21gABAAAAANMtYXBwbOz9o444hUfDbbS9T3raGC8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACmRlc2MA" 
/>

<h1>üêü The Raw Report ‚Äî Sushi Fish ID</h1>
<p>Upload a sushi box photo ‚Üí get a left-to-right, row-by-row breakdown of fish & garnishes.</p>

<!-- Upload sushi photo -->
<div class="card">
  <label>Upload sushi photo</label>
  <input id="file" type="file" accept="image/*" />
  <img id="preview" alt="Preview" />
</div>

<!-- Optional context -->
<div class="card">
  <label>Optional context (helps accuracy)</label>
  <input id="context" type="text" placeholder="e.g., came with tuna roll + miso; $48 delivered; Murray Hill; deluxe box" />
</div>

<!-- Identify button -->
<button id="identifyBtn">Identify Fish</button>

<!-- Result -->
<div class="card">
  <label>Result</label>
  <pre id="result"></pre>
</div>

<script>
const apiKey = "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"; // üîπ Replace with your real key

const fileInput = document.getElementById('file');
const preview = document.getElementById('preview');
const result = document.getElementById('result');
const identifyBtn = document.getElementById('identifyBtn');

fileInput.addEventListener('change', () => {
  const file = fileInput.files[0];
  if (!file) return;
  preview.src = URL.createObjectURL(file);
  preview.style.display = 'block';
});

identifyBtn.addEventListener('click', async () => {
  const file = fileInput.files[0];
  if (!file) {
    alert("Please upload a sushi photo first.");
    return;
  }

  result.textContent = "Identifying fish...";
  
  const base64 = await toBase64(file);
  const context = document.getElementById('context').value;

  const prompt = `
You are identifying sushi pieces in ONE photo.

OUTPUT FORMAT:
Row 1:
1) <fish/item> ‚Äî <garnish/sauce/notes>
2) ...
Row 2:
...
Notes:
- ...
- ...

RULES:
- Count total pieces first (including rolls) and ensure your breakdown covers them all.
- Go row-by-row (top to bottom), left-to-right.
- Number each piece. If multiple identical pieces are in the same row, use "n√ó <fish> ‚Äî ..." instead of repeating.
- Do NOT merge across rows unless they are visually identical with the same garnish.
- If uncertain, say "likely <fish>" and ONE alternative in parentheses.
- Use sushi-specific visual cues:
    ‚Ä¢ Salmon (sake): orange with white fat lines; belly has more marbling.
    ‚Ä¢ Tuna (maguro): deep red; chutoro is pink marbled; otoro is pale pink with heavy marbling.
    ‚Ä¢ Yellowtail (hamachi): beige-pink with a darker edge near skin.
    ‚Ä¢ Fluke (hirame): translucent white with fine grain.
    ‚Ä¢ Snapper (tai): translucent with red skin edge or crosshatch pattern.
    ‚Ä¢ Mackerel (saba): silver skin with stripes; often vinegared.
    ‚Ä¢ Escolar (butterfish): opaque white, dense texture.
    ‚Ä¢ Scallop (hotate): round, glossy white; torched if surface browned.
- Mention if toro is present, but do NOT state "no toro" if absent.
- Keep Notes section short (2‚Äì3 bullets), in a casual Raw Report tone (e.g., "Cuts are tight", "Rice a bit cold", "Garnish game strong").
Extra context (may help accuracy): ${context}
`;

  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [
          { role: "system", content: "You are a sushi expert who can visually identify fish types from photos." },
          { role: "user", content: [
            { type: "text", text: prompt },
            { type: "image_url", image_url: { url: base64 } }
          ]}
        ],
        max_tokens: 500
      })
    });

    const data = await response.json();
    result.textContent = data.choices?.[0]?.message?.content || "No result.";
  } catch (err) {
    console.error(err);
    result.textContent = "Error identifying fish.";
  }
});

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
  });
}
</script>

</body>
</html>
